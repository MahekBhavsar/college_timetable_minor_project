<app-student-navbar>
  <div class="container-fluid py-2">

    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <h4 class="fw-bold text-dark mb-1">ðŸ“š My Assignments</h4>
        <p class="text-muted small">Manage and submit your coursework</p>
      </div>
      <span class="badge bg-primary-subtle text-primary px-3 py-2 rounded-pill">
        {{ assignments().length }} Total Tasks
      </span>
    </div>

    @if (loading()) {
    <div class="d-flex justify-content-center align-items-center py-5">
      <div class="spinner-border text-primary me-2" role="status"></div>
      <span class="text-muted">Loading assignments...</span>
    </div>
    }

    @else {

    @if (assignments().length === 0) {
    <div class="card border-0 shadow-sm rounded-4 text-center p-5">
      <i class="bi bi-journal-x fs-1 text-muted opacity-50 mb-3"></i>
      <h5 class="text-dark">No assignments available</h5>
      <p class="text-muted small">Your instructors haven't posted any tasks for your class yet.</p>
    </div>
    }

    <div class="row g-4">
      @for (a of assignments(); track a.id) {
      <div class="col-md-6 col-xl-4">
        <div class="card shadow-sm border-0 rounded-4 h-100 bg-white">
          <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge bg-primary-subtle text-primary rounded-pill px-3">
                {{a.subject}}
              </span>

              <span class="badge rounded-pill px-3" 
                    [ngClass]="a.type === 'HOME' ? 'bg-success-subtle text-success' : 'bg-warning-subtle text-warning'">
                <i class="bi" [ngClass]="a.type === 'HOME' ? 'bi-house-door-fill' : 'bi-building-fill'"></i>
                {{a.type}}
              </span>
            </div>

            <h5 class="fw-bold text-dark mb-2">{{a.title}}</h5>

            <p class="text-secondary small mb-3">
              {{a.description || 'No specific instructions provided.'}}
            </p>

            <div class="d-flex align-items-center small text-danger fw-medium mb-4">
              <i class="bi bi-calendar-event me-2"></i>
              Due: {{a.date | date:'dd MMM yyyy'}}
            </div>

            <hr class="opacity-10 mb-4">

            @if (a.type === 'HOME' && a.fileData) {
            <button class="btn btn-outline-primary btn-sm w-100 rounded-3 mb-3 d-flex align-items-center justify-content-center gap-2" 
                    (click)="viewFile(a.fileData, a.fileName)">
              <i class="bi bi-file-earmark-arrow-down fs-6"></i>
              Download Material
            </button>
            }

            @if (a.type === 'HOME') {

              @if (submittedMap()[a.id]) {
                <div class="bg-light rounded-4 p-3 border border-success border-opacity-25">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="badge bg-success rounded-pill px-3">
                      <i class="bi bi-check-circle-fill me-1"></i> {{ submittedMap()[a.id].status }}
                    </span>
                    <small class="text-muted">{{ submittedMap()[a.id].submittedAt | date:'dd MMM' }}</small>
                  </div>
                  
                  <button class="btn btn-sm btn-white border w-100 text-dark small rounded-3" 
                          (click)="viewFile(submittedMap()[a.id].fileData, submittedMap()[a.id].fileName)">
                    <i class="bi bi-file-earmark-text text-primary me-1"></i>
                    {{ submittedMap()[a.id].fileName }}
                  </button>
                </div>
              }

              @else {
                <div class="mt-2">
                  <label class="small text-muted mb-2 d-block">Upload your response (PDF/Doc)</label>
                  <div class="input-group input-group-sm mb-3">
                    <input type="file" class="form-control rounded-start-3" id="inputGroupFile{{a.id}}" (change)="selectResponseFile($event, a.id)">
                  </div>

                  <button class="btn btn-success w-100 rounded-3 shadow-sm d-flex align-items-center justify-content-center gap-2" 
                          (click)="submitResponse(a)" 
                          [disabled]="uploadingId() === a.id">
                    @if (uploadingId() === a.id) {
                      <span class="spinner-border spinner-border-sm"></span>
                      Submitting...
                    } @else {
                      <i class="bi bi-cloud-arrow-up"></i>
                      Submit Assignment
                    }
                  </button>
                </div>
              }
            }

          </div> </div> </div> }
    </div> }
  </div>
</app-student-navbar>